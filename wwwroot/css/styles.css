/* =========================================================
   BASE GLOBAL
   - Fuente por defecto del sistema
   - Color de texto base (fallback)
========================================================= */
:root {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  color: #111827;
}

/* =========================================================
   RESET / FULL HEIGHT
   MUY IMPORTANTE:
   - html y body deben medir 100% para que el layout full-screen funcione
========================================================= */
html,
body {
  margin: 0;
  padding: 0;
  height: 100%;
}

/* =========================================================
   BODY (contenedor global)
   - Fondo oscuro base
   - display:flex para soportar layout full-screen
   - overflow:hidden evita scroll global (el scroll va en .messages)
========================================================= */
body {
  background: #0a1014;
  
  height: 100vh;
  overflow: hidden; /* sin scroll global */
}

/* =========================================================
   LAYOUT PRINCIPAL (.app)
   - Ocupa todo el ancho y alto
   - Grid con 2 columnas: sidebar + chat
   - minmax(0, 1fr) evita que el contenido “empuje” y rompa el diseño
========================================================= */
.app {
  width: 100%;
  height: 100vh;
  background: #f0f2f5;
  display: grid;

  /* Sidebar fijo (280px) + contenido flexible */
  grid-template-columns: 280px minmax(0, 1fr);

  /* Permite que hijos con overflow funcionen correctamente en grid */
  min-height: 0;
}

/* =========================================================
   SIDEBAR
   - Columna izquierda estilo WhatsApp
========================================================= */
.sidebar {
  background: #202c33;
  color: #e9edef;
  display: flex;
  flex-direction: column;
}

/* =========================================================
   HEADER SIDEBAR
   - Zona superior con título y botones (ej. toggle theme)
========================================================= */
.sidebar-header {
  padding: 12px 16px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 6px;
}

.sidebar-header .title {
  font-size: 16px;
  font-weight: 600;
}

.sidebar-header small {
  font-size: 11px;
  opacity: 0.8;
}

/* =========================================================
   SECCIONES DE SIDEBAR (labels tipo "Tu sesión")
========================================================= */
.sidebar-section {
  padding: 10px 12px 6px;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  opacity: 0.7;
}

/* =========================================================
   CONTROLES DE SIDEBAR (inputs + botones join/leave)
========================================================= */
.sidebar-controls {
  padding: 0 12px 10px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* Inputs de usuario y sala:
   - width 100% para ocupar todo el espacio
   - box-sizing para que padding no “rompa” el ancho */
.sidebar-controls input {
  display: block;
  width: 100%;
  box-sizing: border-box;
  padding: 8px 10px;
  border-radius: 6px;
  border: none;
  font-size: 13px;
  background: #2a3942;
  color: #e9edef;
}

.sidebar-controls input::placeholder {
  color: #8696a0;
}

/* Fila de botones (Join / Leave) */
.sidebar-controls-row {
  display: flex;
  gap: 8px;
  align-items: center;
}

.sidebar-controls-row button {
  flex: 1; /* ambos botones mismo ancho */
  border-radius: 8px;
  border: none;
  padding: 8px 0;
  font-size: 13px;
  cursor: pointer;
  font-weight: 500;
}

/* Botón Join */
.btn-join {
  background: #00a884;
  color: white;
}

.btn-join:disabled {
  background: #1f3b36;
  color: #6c8b81;
  cursor: default;
}

/* Botón Leave */
.btn-leave {
  background: #374045;
  color: #e4e6eb;
}

.btn-leave:disabled {
  opacity: 0.4;
  cursor: default;
}

/* Footer de sidebar (texto pequeño al final) */
.sidebar-footer {
  margin-top: auto; /* empuja al final */
  padding: 10px 12px;
  font-size: 11px;
  opacity: 0.7;
}

/* =========================================================
   MAIN CHAT (panel derecho)
   - flex column para header + messages + input
   - min-width/min-height 0 evitan roturas en grid
========================================================= */
.chat {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 0; /* importante para overflow interno */
  min-width: 0;  /* evita que contenido expanda el grid */
  background: #0a1014;
  color: #e9edef;
}

/* Header del chat: nombre sala y estado */
.chat-header {
  padding: 10px 16px;
  background: #202c33;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-left: 1px solid #202c33;
}

.chat-header .info {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.chat-header .info .room-name {
  font-weight: 600;
  font-size: 14px;
}

.chat-header .info .status {
  font-size: 11px;
  color: #8696a0;
}

/* =========================================================
   LISTA DE MENSAJES
   - scroll SOLO aquí
   - gap/padding compactos
   - scrollbar custom
========================================================= */
.messages {
  flex: 1;
  padding: 8px 16px 6px;
  overflow-y: auto;

  display: flex;
  flex-direction: column;
  gap: 4px; /* espacio entre mensajes */
  min-height: 0;

  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
}

/* Scrollbar (Chrome/Edge) */
.messages::-webkit-scrollbar {
  width: 6px;
}

.messages::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 999px;
}

/* =========================================================
   BURBUJAS DE MENSAJE
   - compactas, responsivas, con word-wrap
========================================================= */
.bubble {
  max-width: 78%;
  padding: 4px 8px;
  border-radius: 10px;
  font-size: 12px;
  line-height: 1.3;
  display: inline-block;
  word-wrap: break-word;
  white-space: pre-wrap; /* respeta saltos de línea */
}

/* Burbuja de mis mensajes (derecha) */
.bubble.me {
  align-self: flex-end;
  background: #005c4b;
  border-bottom-right-radius: 2px;
}

/* Burbuja de otros (izquierda) */
.bubble.other {
  align-self: flex-start;
  background: #202c33;
  border-bottom-left-radius: 2px;
}

/* Nombre del usuario dentro de la burbuja */
.bubble .user {
  display: block;
  font-weight: 600;
  font-size: 10px;
  margin-bottom: 1px;
  color: #b1b3b5;
}

/* Hora / metadata */
.bubble .meta {
  display: flex;
  justify-content: flex-end;
  gap: 4px;
  font-size: 9px;
  color: #b1b3b5;
  margin-top: 2px;
}

/* Mensajes de sistema (centrados y discretos) */
.system-msg {
  align-self: center;
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 999px;
  background: rgba(32, 44, 51, 0.9);
  color: #b1b3b5;
  margin: 2px 0;
}

/* Indicador “está escribiendo…” */
.typing-indicator {
  min-height: 16px;
  font-size: 10px;
  color: #8696a0;
  padding: 0 16px 4px;
}

/* =========================================================
   INPUT DEL CHAT
   - barra inferior (emoji, stickers, input, enviar)
========================================================= */
.chat-input {
  padding: 8px 12px;
  background: #202c33;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Wrapper del input para que no “se coma” el botón enviar */
.msg-input-wrapper {
  flex: 1;
  margin-right: 8px;
}

/* Input principal */
#message {
  width: 100%;
  padding: 9px 14px;
  border-radius: 20px;
  border: none;
  font-size: 14px;
  background: #2a3942;
  color: #e9edef;
  box-sizing: border-box;
}

/* Focus visible con aro verde */
#message:focus {
  outline: none;
  box-shadow: 0 0 0 2px #00a884;
}

/* =========================================================
   BOTONES ICONO (emoji / etc.)
========================================================= */
.icon-btn {
  background: transparent;
  border: none;
  color: #8696a0;
  cursor: pointer;

  display: flex;
  align-items: center;
  justify-content: center;

  padding: 4px;
  border-radius: 999px;
}

.icon-btn .material-icons {
  font-size: 20px;
}

/* Stickers compactos */
.stickers {
  display: flex;
  gap: 3px;
}

.sticker-btn {
  border-radius: 14px;
  padding: 2px 6px;
  font-size: 13px;
  border: none;
  cursor: pointer;
  background: #2a3942;
  color: #e9edef;
}

.sticker-btn:hover {
  background: #3b4a53;
}

/* Botón enviar estilo WhatsApp */
.send-btn {
  background: #00a884;
  color: #ffffff;
  border: none;

  width: 40px;
  height: 40px;
  border-radius: 50%;

  display: flex;
  align-items: center;
  justify-content: center;

  cursor: pointer;
  transition: background 0.2s ease, transform 0.1s ease;
  padding: 0;
}

.send-btn .material-icons {
  font-size: 22px;
  transform: translateX(1px); /* centrado óptico */
}

.send-btn:hover {
  background: #01c095;
}

.send-btn:active {
  transform: scale(0.92);
}

.send-btn:disabled {
  background: #1f3b36;
  color: #6c8b81;
  cursor: default;
  opacity: 0.6;
}

/* =========================================================
   THEME SYSTEM (Dark / Light)
   - Variables CSS para cambiar colores sin reescribir todo
========================================================= */
:root {
  --bg: #0a1014;
  --panel: #202c33;
  --panel2: #2a3942;
  --text: #e9edef;
  --muted: #8696a0;
  --me: #005c4b;
  --other: #202c33;
  --accent: #00a884;
}

/* Tema claro: sobreescribe variables */
body[data-theme="light"] {
  --bg: #f3f4f6;
  --panel: #ffffff;
  --panel2: #f1f5f9;
  --text: #0f172a;
  --muted: #64748b;
  --me: #d1fae5;
  --other: #ffffff;
  --accent: #2563eb;
}

/* Aplica variables a componentes */
body { background: var(--bg); }

.sidebar {
  background: var(--panel);
  color: var(--text);
}

.chat-header { background: var(--panel); }
.chat-input  { background: var(--panel); }

#message {
  background: var(--panel2);
  color: var(--text);
}

#message::placeholder { color: var(--muted); }

.bubble.me {
  background: var(--me);
  color: var(--text);
}

.bubble.other {
  background: var(--other);
  color: var(--text);
}

.bubble .user,
.bubble .meta {
  color: var(--muted);
}

.system-msg {
  background: color-mix(in srgb, var(--panel) 85%, transparent);
  color: var(--muted);
}

.send-btn { background: var(--accent); }
.send-btn:hover { filter: brightness(1.05); }

/* =========================================================
   AVATAR + LAYOUT DE MENSAJE
   - fila con avatar + burbuja
========================================================= */
.msg-row {
  display: flex;
  align-items: flex-end;
  gap: 8px;
  max-width: 100%;
}

.msg-row.me {
  justify-content: flex-end;
}

/* Avatar para mensajes de otros */
.avatar {
  width: 28px;
  height: 28px;
  border-radius: 50%;

  display: inline-flex;
  align-items: center;
  justify-content: center;

  font-size: 12px;
  font-weight: 700;
  color: #fff;

  flex: 0 0 auto;
  user-select: none;
}

/* Para mis mensajes, ocultamos avatar (estilo WhatsApp) */
.msg-row.me .avatar {
  display: none;
}

/* =========================================================
   ANIMACIÓN "POP IN" (aparece inflándose)
========================================================= */
.bubble {
  transform-origin: bottom left;
  animation: popIn 160ms ease-out;
}

.bubble.me {
  transform-origin: bottom right;
}

@keyframes popIn {
  from { transform: scale(0.96); opacity: 0; }
  to   { transform: scale(1); opacity: 1; }
}

/* =========================================================
   TOGGLE THEME (botón)
========================================================= */
.theme-toggle {
  display: inline-flex;
  align-items: center;
  gap: 8px;

  border: 1px solid color-mix(in srgb, var(--muted) 35%, transparent);
  background: transparent;
  color: var(--text);

  padding: 6px 10px;
  border-radius: 999px;
  cursor: pointer;
  font-size: 12px;
}

.theme-toggle .material-icons {
  font-size: 18px;
  color: var(--muted);
}

/* =========================================================
   BUZZ (animación shake)
   - clase .buzz se añade a .chat desde JS
========================================================= */
@keyframes buzzShake {
  0%   { transform: translateX(0); }
  10%  { transform: translateX(-6px); }
  20%  { transform: translateX(6px); }
  30%  { transform: translateX(-5px); }
  40%  { transform: translateX(5px); }
  50%  { transform: translateX(-4px); }
  60%  { transform: translateX(4px); }
  70%  { transform: translateX(-3px); }
  80%  { transform: translateX(3px); }
  90%  { transform: translateX(-2px); }
  100% { transform: translateX(0); }
}

.buzz {
  animation: buzzShake 420ms ease-in-out;
}

/* Botón de buzz */
#buzzBtn {
  background: transparent;
  border: none;
  cursor: pointer;

  font-size: 18px;
  padding: 8px;
  border-radius: 8px;

  opacity: 0.7;
  transition: background 0.2s, opacity 0.2s, transform 0.1s;
}

#buzzBtn:hover {
  opacity: 1;
  background: rgba(255, 255, 255, 0.1);
}

#buzzBtn:active {
  transform: scale(0.9);
}

/* =========================================================
   EMOJI PANEL
   - Panel flotante sobre el input
========================================================= */
.emoji-wrap {
  position: relative;
}

.emoji-panel {
  position: absolute;
  bottom: 48px; /* arriba del input */
  left: 0;

  width: 280px;
  max-height: 220px;
  overflow-y: auto;

  background: #111b21;
  border: 1px solid rgba(255,255,255,0.10);
  border-radius: 12px;
  padding: 10px;

  display: none;   /* se alterna con JS */
  z-index: 99999;  /* por encima de todo */
  box-shadow: 0 12px 30px rgba(0,0,0,.45);
}

.emoji-panel span {
  cursor: pointer;
  font-size: 20px;
  padding: 6px;
  display: inline-block;
  border-radius: 8px;
}

.emoji-panel span:hover {
  background: rgba(255,255,255,0.10);
}

/* =========================================================
   RESPONSIVE (Mobile/Tablet)
   Objetivo:
   - En móviles: sidebar como panel deslizable + overlay
   - En tablets: sidebar más angosto
========================================================= */

/* Base helpers */
* { box-sizing: border-box; }

/* Desktop ya está OK. Ajuste tablet */
@media (max-width: 1024px) {
  .app {
    grid-template-columns: 260px minmax(0, 1fr);
  }
}

/* ====== MÓVIL: sidebar off-canvas ====== */
@media (max-width: 820px) {
  body {
    height: 100svh; /* mejor en móvil que 100vh */
  }

  .app {
    /* En móvil ya no queremos 2 columnas fijas */
    grid-template-columns: 1fr;
    position: relative;
  }

  /* Sidebar como drawer */
  .sidebar {
    position: fixed;
    top: 0;
    left: 0;

    width: min(86vw, 320px);
    height: 100svh;

    z-index: 2000;
    transform: translateX(-105%);
    transition: transform 0.22s ease;
    box-shadow: 18px 0 40px rgba(0,0,0,.45);
  }

  /* Cuando esté abierto */
  .app.sidebar-open .sidebar {
    transform: translateX(0);
  }

  /* Overlay para cerrar tocando afuera */
  .sidebar-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.45);
    z-index: 1500;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.22s ease;
  }

  .app.sidebar-open .sidebar-overlay {
    opacity: 1;
    pointer-events: auto;
  }

  /* El chat ocupa todo */
  .chat {
    height: 100svh;
  }

  /* Header: que no se apriete feo */
  .chat-header {
    gap: 10px;
  }

  /* Badge fuera en móvil (ocupa espacio) */
  .chat-header .badge {
    display: none;
  }

  /* Mensajes con padding un poco menor */
  .messages {
    padding: 10px 12px 8px;
  }

  /* Burbuja un poquito más grande en móvil */
  .bubble {
    max-width: 88%;
    font-size: 13px;
    padding: 6px 10px;
  }

  /* Input: stickers fuera (si quieres) */
  .stickers {
    display: none;
  }

  /* Emoji panel: que no se salga de pantalla */
  .emoji-panel {
    width: min(78vw, 320px);
    left: 0;
  }
}

/* ====== EXTRA: MÓVIL CHIQUITO ====== */
@media (max-width: 420px) {
  .chat-input {
    gap: 6px;
    padding: 8px 10px;
  }

  #message {
    padding: 10px 12px;
    font-size: 14px;
  }

  .icon-btn .material-icons {
    font-size: 22px;
  }

  .send-btn {
    width: 42px;
    height: 42px;
  }
}

.menu-btn {
  display: none; /* en desktop se oculta */
}

/* En móvil lo mostramos */
@media (max-width: 820px) {
  .menu-btn {
    display: inline-flex;
  }
}

/* ================================
   FIX DEFINITIVO DESKTOP vs MOBILE
   (Pegar al FINAL del styles.css)
================================ */

/* 1) Evita que body flex te rompa el alto/ancho */
html, body { height: 100%; }

body{
  margin: 0;
  padding: 0;
  display: block !important;   /* <-- clave */
  height: 100vh !important;
  overflow: hidden;
}

/* 2) Asegura que el contenedor principal use todo el viewport */
#appRoot{
  width: 100vw !important;
  height: 100vh !important;
}

/* 3) Desktop: SIEMPRE 2 columnas */
@media (min-width: 821px){
  #appRoot{
    display: grid !important;
    grid-template-columns: 280px minmax(0, 1fr) !important;
  }

  /* En desktop NO queremos overlay */
  .sidebar-overlay{ display:none !important; }
}

/* 4) Mobile: drawer (lo tuyo) */
@media (max-width: 820px){
  #appRoot{
    grid-template-columns: 1fr !important;
    position: relative;
  }

  .sidebar{
    position: fixed;
    top: 0; left: 0;
    width: min(86vw, 320px);
    height: 100svh;
    z-index: 2000;
    transform: translateX(-105%);
    transition: transform .22s ease;
    box-shadow: 18px 0 40px rgba(0,0,0,.45);
  }

  #appRoot.sidebar-open .sidebar{ transform: translateX(0); }

  .sidebar-overlay{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.45);
    z-index: 1500;
    opacity: 0;
    pointer-events: none;
    transition: opacity .22s ease;
  }

  #appRoot.sidebar-open .sidebar-overlay{
    opacity: 1;
    pointer-events: auto;
  }
}
